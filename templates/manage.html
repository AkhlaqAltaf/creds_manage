{% extends "base.html" %}

{% block title %}Management{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/manage.css') }}">
<style>
    .filter-section {
        background: #f8fafc;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
    }
    
    .filter-group label {
        font-weight: 600;
        margin-bottom: 5px;
        color: #374151;
        font-size: 14px;
    }
    
    .filter-select, .filter-input {
        padding: 10px 12px;
        border: 2px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        background: white;
        transition: border-color 0.2s;
    }
    
    .filter-select:focus, .filter-input:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .domain-extensions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 5px;
    }
    
    .extension-tag {
        background: #e0e7ff;
        color: #3730a3;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
        border: 1px solid #c7d2fe;
    }
    
    .extension-tag:hover {
        background: #c7d2fe;
    }
    
    .extension-tag.active {
        background: #4f46e5;
        color: white;
        border-color: #4f46e5;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    
    .process-status-btn {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
    }
    
    .process-status-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }
    
    .export-btn {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
    }
    
    .export-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    
    .custom-extension {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    
    .custom-extension input {
        flex: 1;
        padding: 10px 12px;
        border: 2px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
    }
    
    .add-extension-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
    }
    
    .active-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 15px;
        padding: 10px;
        background: #f1f5f9;
        border-radius: 6px;
    }
    
    .filter-badge {
        background: #e0e7ff;
        color: #3730a3;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .remove-filter {
        cursor: pointer;
        font-size: 14px;
        line-height: 1;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', path='js/manage.js') }}"></script>
{% endblock %}

{% block content %}

<div class="container">
    <div class="header">
        <h1>‚öôÔ∏è Management Dashboard</h1>
        <a href="/" class="nav-link">Back to Credentials</a>
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üåê</div>
            <div class="stat-label">Total Domains</div>
            <div class="stat-value" id="total-domains">{{ stats.total_domains }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-label">Online Domains</div>
            <div class="stat-value" style="color: #10b981;" id="online-domains">{{ stats.online_domains }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-label">Offline Domains</div>
            <div class="stat-value" style="color: #ef4444;" id="offline-domains">{{ stats.offline_domains }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üîë</div>
            <div class="stat-label">Total Credentials</div>
            <div class="stat-value" id="total-credentials">{{ stats.total_credentials }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚úì</div>
            <div class="stat-label">Accessed Credentials</div>
            <div class="stat-value" style="color: #10b981;" id="accessed-credentials">{{ stats.accessed_credentials }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üìÑ</div>
            <div class="stat-label">Unprocessed Files</div>
            <div class="stat-value" style="color: #f59e0b;" id="unprocessed-files">{{ stats.unprocessed_files }}</div>
        </div>
    </div>
    
    <!-- Export Credentials Section -->
    <div class="action-section">
        <h2>üì§ Export Credentials</h2>
        <div class="filter-section">
            <div class="filter-grid">
                <div class="filter-group">
                    <label>Checked Status:</label>
                    <select class="filter-select" id="export-checked-filter">
                        <option value="not_checked" selected>Not Checked</option>
                        <option value="checked">Checked</option>
                        <option value="all">All</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Accessed Status:</label>
                    <select class="filter-select" id="export-accessed-filter">
                        <option value="all">All</option>
                        <option value="accessed">Accessed Only</option>
                        <option value="not_accessed">Not Accessed</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Working Status:</label>
                    <select class="filter-select" id="export-working-filter">
                        <option value="all">All</option>
                        <option value="working">Working</option>
                        <option value="not_working">Not Working</option>
                        <option value="unknown">Unknown</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Admin Status:</label>
                    <select class="filter-select" id="export-admin-filter">
                        <option value="all">All</option>
                        <option value="admin">Admin Only</option>
                        <option value="not_admin">Not Admin</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Export Format:</label>
                    <select class="filter-select" id="export-format">
                        <option value="excel">Excel (.xlsx)</option>
                        <option value="csv">CSV (.csv)</option>
                        <option value="txt">Text (.txt)</option>
                        <option value="json">JSON (.json)</option>
                    </select>
                </div>
            </div>
            
            <div class="filter-group">
                <label>Domain Extensions:</label>
                <div class="domain-extensions" id="export-domain-extensions">
                    <span class="extension-tag" data-extension=".in">.in</span>
                    <span class="extension-tag" data-extension=".gov.in">.gov.in</span>
                    <span class="extension-tag" data-extension=".gov">.gov</span>
                    <span class="extension-tag" data-extension=".com">.com</span>
                    <span class="extension-tag" data-extension=".org">.org</span>
                    <span class="extension-tag" data-extension=".edu">.edu</span>
                </div>
                
                <div class="custom-extension">
                    <input type="text" id="export-custom-extension" placeholder="Add custom extension (.pk, .net, etc.)">
                    <button class="add-extension-btn" onclick="addExportExtension()">Add</button>
                </div>
            </div>
            
            <div class="filter-group">
                <label>Domain Contains:</label>
                <input type="text" 
                       class="filter-input" 
                       id="export-domain-contains" 
                       placeholder="Enter text to search in domains">
            </div>
            
            <div id="export-active-filters" class="active-filters">
                <!-- Active filters will be shown here -->
            </div>
            
            <div class="action-buttons">
                <button class="export-btn" onclick="exportCredentials()">
                    üì• Export Credentials
                </button>
                <button class="process-btn" onclick="clearExportFilters()" style="background: #6b7280;">
                    üóëÔ∏è Clear Filters
                </button>
            </div>
        </div>
    </div>
    
    <!-- Process Working Status Section -->
    <div class="action-section">
        <h2>üîç Process Working Status</h2>
        <div class="filter-section">
            <p style="color: #6b7280; margin-bottom: 20px;">
                Check domain statuses in parallel and update working status in database.
            </p>
            
            <div class="filter-grid">
                <div class="filter-group">
                    <label>Checked Status:</label>
                    <select class="filter-select" id="status-checked-filter">
                        <option value="not_checked" selected>Not Checked</option>
                        <option value="checked">Checked</option>
                        <option value="all">All</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Accessed Status:</label>
                    <select class="filter-select" id="status-accessed-filter">
                        <option value="all">All</option>
                        <option value="accessed">Accessed Only</option>
                        <option value="not_accessed">Not Accessed</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Working Status:</label>
                    <select class="filter-select" id="status-working-filter">
                        <option value="all">All</option>
                        <option value="working">Working</option>
                        <option value="not_working">Not Working</option>
                        <option value="unknown">Unknown</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Batch Size:</label>
                    <select class="filter-select" id="status-batch-size">
                        <option value="10">10 domains</option>
                        <option value="25" selected>25 domains</option>
                        <option value="50">50 domains</option>
                        <option value="100">100 domains</option>
                    </select>
                </div>
            </div>
            
            <div class="filter-group">
                <label>Domain Extensions:</label>
                <div class="domain-extensions" id="status-domain-extensions">
                    <span class="extension-tag" data-extension=".in">.in</span>
                    <span class="extension-tag" data-extension=".gov.in">.gov.in</span>
                    <span class="extension-tag" data-extension=".gov">.gov</span>
                    <span class="extension-tag" data-extension=".com">.com</span>
                    <span class="extension-tag" data-extension=".org">.org</span>
                    <span class="extension-tag" data-extension=".edu">.edu</span>
                </div>
                
                <div class="custom-extension">
                    <input type="text" id="status-custom-extension" placeholder="Add custom extension (.pk, .net, etc.)">
                    <button class="add-extension-btn" onclick="addStatusExtension()">Add</button>
                </div>
            </div>
            
            <div class="filter-group">
                <label>Domain Contains:</label>
                <input type="text" 
                       class="filter-input" 
                       id="status-domain-contains" 
                       placeholder="Enter text to search in domains">
            </div>
            
            <div id="status-active-filters" class="active-filters">
                <!-- Active filters will be shown here -->
            </div>
            
            <div class="action-buttons">
                <button class="process-status-btn" onclick="processWorkingStatus()">
                    üîÑ Process Working Status
                </button>
                <button class="process-btn" onclick="clearStatusFilters()" style="background: #6b7280;">
                    üóëÔ∏è Clear Filters
                </button>
            </div>
        </div>
        
        <div id="status-processing-section" style="display: none; margin-top: 20px;">
            <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <strong style="color: #92400e;">Processing Working Status</strong>
                    <span id="status-progress-text" style="color: #d97706; font-weight: 600;">0%</span>
                </div>
                <div style="background: white; height: 20px; border-radius: 10px; overflow: hidden; margin-bottom: 10px;">
                    <div id="status-progress-bar" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); height: 100%; width: 0%; transition: width 0.3s;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 14px; color: #92400e;">
                    <span id="status-current-info">Preparing to check domains...</span>
                    <span id="status-processed-count">0/0 domains</span>
                </div>
                <div style="margin-top: 15px; font-size: 13px; color: #92400e;">
                    <span id="status-time-info">Elapsed: 0s | Online: 0 | Offline: 0 | Failed: 0</span>
                </div>
                <div style="margin-top: 10px;">
                    <button class="process-btn" onclick="stopStatusProcessing()" style="background: #dc2626; margin-top: 10px;">
                        ‚èπÔ∏è Stop Processing
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Original Process Files Section -->
    <div class="action-section">
        <h2>Process Credential Files</h2>
        <p style="color: #6b7280; margin-bottom: 20px;">
            Click the button below to process all credential files in the <code>creds</code> folder.
            Files will be parsed and stored in the database, then moved to <code>processed_creds</code> folder.
        </p>
        
        <button class="process-btn" id="process-btn" onclick="processFiles()">
            üîÑ Process Files
        </button>
    </div>
    
    <div class="action-section" style="margin-top: 20px;">
        <h2>Check All Credentials</h2>
        <p style="color: #6b7280; margin-bottom: 20px;">
            Click the button below to mark all domains and credentials as checked (set is_checked to True).
        </p>
        
        <button class="process-btn" id="check-all-btn" onclick="checkAll()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
            ‚úÖ Check All
        </button>
        
        <div class="message" id="check-all-message" style="display: none;"></div>
        
        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p style="margin-top: 10px; color: #6b7280;">Processing files...</p>
        </div>
        
        <div id="progress-section" style="display: none; margin-top: 20px;">
            <div style="background: #f3f4f6; padding: 20px; border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <strong style="color: #333;">Processing Progress</strong>
                    <span id="progress-text" style="color: #667eea; font-weight: 600;">0%</span>
                </div>
                <div style="background: white; height: 24px; border-radius: 12px; overflow: hidden; margin-bottom: 10px;">
                    <div id="progress-bar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100%; width: 0%; transition: width 0.3s;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 14px; color: #6b7280;">
                    <span id="current-file">Starting...</span>
                    <span id="processed-count">0 credentials processed</span>
                </div>
                <div style="margin-top: 10px; font-size: 12px; color: #9ca3af;">
                    <span id="time-info">Elapsed: 0s | Estimated remaining: --</span>
                </div>
            </div>
        </div>
        
        <div class="message" id="message" style="display: none;"></div>
        
        <div class="file-info" id="file-info" style="display: none;">
            <strong>Processing Results:</strong>
            <div id="results"></div>
        </div>
    </div>
</div>
{% endblock %}


 {% extends "base.html" %}


  {% block title %}Credential Manager{% endblock %}


    {% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', path='css/index.css') }}">

    <style>
    .selection-header {
        background: #f8fafc;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #667eea;
        display: none;
    }
    
    .selection-info {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .selected-count {
        font-weight: 600;
        color: #667eea;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .action-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .delete-btn { background: #fef2f2; color: #dc2626; }
    .delete-btn:hover { background: #fee2e2; }
    
    .check-btn { background: #f0f9ff; color: #0284c7; }
    .check-btn:hover { background: #e0f2fe; }
    
    .export-btn { background: #f0fdf4; color: #16a34a; }
    .export-btn:hover { background: #dcfce7; }
    
    .bulk-checkbox {
        margin-right: 10px;
    }
    
    .domain-select-checkbox {
        margin-right: 8px;
    }
    
    .domain-header-select {
        display: flex;
        align-items: center;
        gap: 10px;
    }
</style>
    {% endblock %}

    {% block extra_js %}
    <script src="{{ url_for('static', path='js/index.js') }}"></script>
    {% endblock %}

    {% block content %}

    <div class="container">



            <div id="selectionHeader" class="selection-header">
        <div class="selection-info">
            <div>
                <span class="selected-count" id="selectedCount">0</span> items selected
            </div>
            <div class="action-buttons">
                <button class="action-btn delete-btn" onclick="deleteSelected()">
                    üóëÔ∏è Delete Selected
                </button>
                <button class="action-btn check-btn" onclick="markAsChecked()">
                    ‚úì Mark as Checked
                </button>
                <button class="action-btn export-btn" onclick="exportSelected()">
                    üì§ Export Selected
                </button>
                <button class="action-btn" onclick="clearSelection()" style="background: #f1f5f9; color: #64748b;">
                    ‚úñ Clear Selection
                </button>
            </div>
        </div>
    </div>
    
    <div class="bulk-controls" style="margin-bottom: 15px;">
        <button class="filter-btn" onclick="selectAllDomains()" style="margin-right: 10px;">
            üìÑ Select All Domains on This Page
        </button>
        <button class="filter-btn" onclick="deselectAll()">
            ‚úñ Deselect All
        </button>
    </div>




        <div class="header">
            <h1>üîê Credential Manager</h1>
            <a href="/manage" class="nav-link">Management</a>
            <a href="/api/logout" class="nav-link">Logout</a>

        </div>
        
        <div class="filters">
            <div class="filter-group">
                <label>Status:</label>
                <button class="filter-btn {{ 'active' if status_filter == 'all' }}" onclick="filterByStatus('all')">All</button>
                <button class="filter-btn {{ 'active' if status_filter == 'online' }}" onclick="filterByStatus('online')">Online</button>
                <button class="filter-btn {{ 'active' if status_filter == 'offline' }}" onclick="filterByStatus('offline')">Offline</button>
            </div>
            <div class="filter-group">
                <label>Checked:</label>
                <button class="filter-btn {{ 'active' if checked_filter == 'all' }}" onclick="filterByChecked('all')">All</button>
                <button class="filter-btn {{ 'active' if checked_filter == 'checked' }}" onclick="filterByChecked('checked')">Checked</button>
                <button class="filter-btn {{ 'active' if checked_filter == 'not_checked' }}" onclick="filterByChecked('not_checked')">Not Checked</button>
                <button class="filter-btn {{ 'active' if checked_filter == 'checked_and_working' }}" onclick="filterByChecked('checked_and_working')">Checked & Working</button>
            </div>
            <div class="filter-group">
                <label>Domain:</label>
                <button class="filter-btn {{ 'active' if domain_filter == 'all' }}" onclick="filterByDomain('all')">All</button>
                <button class="filter-btn {{ 'active' if domain_filter == '.in' }}" onclick="filterByDomain('.in')">.in</button>
                <button class="filter-btn {{ 'active' if domain_filter == '.gov' }}" onclick="filterByDomain('.gov')">.gov</button>
                <button class="filter-btn {{ 'active' if domain_filter == '.gov.in' }}" onclick="filterByDomain('.gov.in')">.gov.in</button>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="accessedOnly" {{ 'checked' if accessed_only else '' }} onchange="toggleAccessedFilter()">
                <label for="accessedOnly">Show only accessed credentials</label>
            </div>
            <div class="filter-group" style="margin-left: auto; display: flex; align-items: center; gap: 8px;">
                <input type="text" 
                       id="searchInput" 
                       placeholder="Search domain..." 
                       value="{{ search }}"
                       style="padding: 8px 12px; border: 2px solid #667eea; border-radius: 5px; font-size: 14px; min-width: 200px;"
                       onkeypress="handleSearchKeypress(event)">
                <button class="filter-btn" onclick="performSearch()" style="white-space: nowrap;">üîç Search</button>
                {% if search %}
                <button class="filter-btn" onclick="clearSearch()" style="white-space: nowrap;">‚úñ Clear</button>
                {% endif %}
            </div>
            <button class="filter-btn" onclick="refreshDomainStatuses()">üîÑ Refresh Status</button>
        </div>
        
    <div id="domains-container">
        {% if domains %}
            {% for domain in domains %}
            <div class="domain-card" data-domain-id="{{ domain.id }}" data-domain="{{ domain.domain }}">
                <div class="domain-header">
                    <h3 style="display: flex; align-items: center; gap: 10px; flex: 1; cursor: pointer;" onclick="toggleDomain('{{ domain.id }}')">
                        <div class="domain-header-select">
                            <!-- Domain selection checkbox -->
                            <input type="checkbox" 
                                   class="domain-select-checkbox"
                                   data-domain-id="{{ domain.id }}"
                                   onchange="toggleDomainSelection({{ domain.id }}, this.checked)"
                                   style="width: 20px; height: 20px; cursor: pointer;">
                            
                            <!-- Domain checked status checkbox -->
                            <input type="checkbox" 
                                   {{ 'checked' if domain.is_checked else '' }} 
                                   onclick="event.stopPropagation(); toggleDomainChecked({{ domain.id }}, this.checked)"
                                   style="width: 20px; height: 20px; cursor: pointer;">
                        </div>
                        
                        <span>{{ domain.domain }}</span>
                        <span class="status-badge status-{{ 'online' if domain.is_working == True else 'offline' if domain.is_working == False else 'unknown' }}" id="status-{{ domain.id }}">
                            {{ 'ONLINE' if domain.is_working == True else 'OFFLINE' if domain.is_working == False else 'UNKNOWN' }}
                        </span>
                        {% if domain.is_important %}
                        <span style="color: #fbbf24;">‚≠ê</span>
                        {% endif %}
                    </h3>
                    <span class="expand-icon" id="icon-{{ domain.id }}" onclick="toggleDomain('{{ domain.id }}')" style="cursor: pointer;">‚ñº</span>
                </div>
                <div class="domain-content" id="content-{{ domain.id }}">
                    <div id="creds-container-{{ domain.id }}">
                        {% if domain.credentials %}
                        <table class="credentials-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;">
                                        <input type="checkbox" 
                                               class="select-all-credential"
                                               data-domain-id="{{ domain.id }}"
                                               onchange="selectAllCredentialsInDomain({{ domain.id }}, this.checked)"
                                               style="width: 20px; height: 20px; cursor: pointer;">
                                    </th>
                                    <th>Check</th>
                                    <th>URL</th>
                                    <th>Username</th>
                                    <th>Password</th>
                                    <th>Accessed</th>
                                </tr>
                            </thead>
                            <tbody id="creds-tbody-{{ domain.id }}">
                                {% for cred in domain.credentials %}
                                <tr>
                                    <td>
                                        <input type="checkbox" 
                                               class="credential-select-checkbox"
                                               data-credential-id="{{ cred.id }}"
                                               data-domain-id="{{ domain.id }}"
                                               onchange="updateSelection()"
                                               style="width: 20px; height: 20px; cursor: pointer;">
                                    </td>
                                    <td>
                                        <input type="checkbox" {{ 'checked' if cred.is_checked else '' }} 
                                               onchange="toggleCredentialChecked({{ cred.id }}, this.checked)"
                                               style="width: 20px; height: 20px; cursor: pointer;">
                                    </td>
                                    <td class="url-cell">
                                        <a href="{{ cred.url }}" target="_blank" class="url-link">{{ cred.url }}</a>
                                    </td>
                                    <td>
                                        {{ cred.user }}
                                        <button class="copy-btn" onclick="copyToClipboard({{ cred.user|tojson }}, this)">Copy</button>
                                    </td>
                                    <td>
                                        <span>{{ cred.password }}</span>
                                        <button class="copy-btn" onclick="copyToClipboard({{ cred.password|tojson }}, this)">Copy</button>
                                    </td>
                                    <td>
                                        <input type="checkbox" {{ 'checked' if cred.is_accessed else '' }} 
                                               onchange="toggleAccessed({{ cred.id }}, this.checked)"
                                               style="width: 20px; height: 20px; cursor: pointer;">
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% if domain.total_credentials > (domain.credentials|length) %}
                        <div style="text-align: center; margin-top: 15px; padding: 15px;">
                            <button class="load-more-btn" onclick="loadMoreCredentials({{ domain.id }}, {{ domain.credentials|length }})" 
                                    id="load-more-{{ domain.id }}">
                                Load More (Showing {{ domain.credentials|length }} of {{ domain.total_credentials }})
                            </button>
                            <div id="loading-more-{{ domain.id }}" style="display: none; color: #667eea; margin-top: 10px;">
                                Loading more credentials...
                            </div>
                        </div>
                        {% endif %}
                        {% else %}
                        <p style="padding: 20px; color: #9ca3af;">No credentials found for this domain.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
            
            <button class="update-status-btn" onclick="updateWorkingStatus()">Update Working Status</button>
        {% else %}
            <div class="empty-state">
                <h2>No credentials found</h2>
                <p>Process credential files from the management page to get started.</p>
            </div>
        {% endif %}
    </div>
    
    {% if total_pages > 1 %}
    <div class="pagination">
        <button onclick="changePage({{ current_page - 1 }})" {{ 'disabled' if current_page == 1 else '' }}>Previous</button>
        <span class="page-info">Page {{ current_page }} of {{ total_pages }} (Total: {{ total }})</span>
        <button onclick="changePage({{ current_page + 1 }})" {{ 'disabled' if current_page >= total_pages else '' }}>Next</button>
    </div>
    {% endif %}
</div>






    {% endblock %}



  


